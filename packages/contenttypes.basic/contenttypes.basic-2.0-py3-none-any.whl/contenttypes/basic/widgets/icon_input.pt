<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      i18n:domain="contenttypes.basic"
      tal:omit-tag="">

  <style>
    #formfield-form-widgets-icon_id { 
      position: relative; 
    }
    .select-icon {
      display: inline-block;
    }
    .select-icon:hover { 
      background-color: antiquewhite;
    }
    .icon,
    .icon-choice,
    .icon-selected {
      display: inline-block; 
      width: 3rem; 
      height: 3rem; 
    }
    .pointer { 
      cursor: pointer; 
    }
    .modal-content { 
      padding: 2rem 
    }
  </style>

  <input type="hidden" id="form-widgets-icon_id_${python:view.id}" name="${python:view.name}" value="${python:view.value}"/>

  <div class="button-div"> 
      <button type="button" class="btn btn-primary me-4" data-bs-toggle="modal" data-bs-target="#modal_${python:view.id}">
        <tal:not_value condition="python:not view.value" i18n:translate="">Add icon</tal:not_value>
        <tal:value condition="python:view.value" i18n:translate="">Change icon</tal:value>
      </button>
      <svg viewBox="0 0 100 100" class="icon-choice" xmlns:xlink="http://www.w3.org/1999/xlink">
        <use id="selected_icon_id_${python:view.id}" xlink:href="${python:view.portal_url}/sprite-icons#${python:view.value}"></use>
      </svg>
  </div>

  <div class="modal fade" id="modal_${python:view.id}" tabindex="-1" aria-labelledby="modalIconLabel-${python:view.id}" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalIconLabel-${python:view.id}" i18n:translate="">Select an icon</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex flex-wrap">
          <tal:repeat repeat="item python:view.xml">
              <a class="select-icon m-2" href="#form-widgets-icon_id_${python:view.id}" data-id="${item}" data-modal-id="${python:view.id}">
                  <svg viewBox="0 0 100 100" class="icon pointer shape-codepen" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <use xlink:href="sprite-icons#${item}"></use>
                  </svg>
              </a>
          </tal:repeat>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script keep-body="true">
    $(function() {
      $('.select-icon').on('click', function (e) {
        var data_id = $(this).data('id');
        var data_modal_id = $(this).data('modal-id');
        var url_svg = '${python:view.portal_url}/sprite-icons#';
        $('#form-widgets-icon_id_' + data_modal_id).attr('value', data_id);
        $('#selected_icon_id_' + data_modal_id).attr('xlink:href', url_svg + data_id);
        $('.btn-close').click();
      })
    })
  </script>

</html>