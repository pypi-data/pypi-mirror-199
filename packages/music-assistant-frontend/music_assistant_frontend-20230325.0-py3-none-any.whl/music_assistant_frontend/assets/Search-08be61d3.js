import{s as q}from"./vue-virtual-scroller.esm-1d586c71.js";/* empty css                             */import{d as A,e as H,G as J,r as u,c as k,z as L,o as O,A as Q,h as v,q as g,b as i,l as V,w as n,F as S,x as T,i as b,p as _,k as m,v as $,m as W,s as P,n as R,j as X,U as Y}from"./index-6b8e9665.js";import{L as Z}from"./ListviewItem-d7abb943.js";import{_ as z,V as ee,a as te}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-59990fbf.js";import{V as ae,a as le,b as se}from"./VSelect-2ae84853.js";import{V as re,a as oe}from"./VRow-ea08c5c4.js";import{V as ie}from"./VTooltip-f86f9b47.js";import{a as ue,l as ne}from"./VBtn-78ffa2a3.js";import{V as ve}from"./VToolbar-acf511e0.js";import"./_plugin-vue_export-helper-6250856a.js";import"./MediaItemThumb.vue_vue_type_style_index_0_lang-bf526eac.js";import"./VCardText-3c6786ab.js";import"./ProviderIcon.vue_vue_type_script_setup_true_lang-fa2998bf.js";import"./VCard-a22457ec.js";import"./forwardRefs-5242d0a6.js";import"./VDivider-eaeef5d4.js";import"./VMenu-c38191cf.js";import"./VLabel-d92bd734.js";import"./VCheckboxBtn-f98fa7cc.js";import"./VDialog-e023b317.js";/* empty css              */const me={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},pe={key:2},de={style:{"margin-left":"15px"}},Ue=A({__name:"Search",props:{initSearch:null},setup(U){const x=U,N=H(),{mobile:D}=J(),s=u("list"),y=u(0),r=u(""),p=u(!1),l=u(),w=u(!1),d=u(!1),c=u([]),C=u(),M=["topresult","artists","albums","tracks","playlists"],E=k(()=>D.value?140:150),G=function(){s.value==="panel"?s.value="list":s.value="panel",localStorage.setItem(`viewMode.search.${o.value}`,s.value)},B=function(e){c.value=[e],d.value=!0},F=function(e){var t;["artist","album","playlist"].includes(e.media_type)||!((t=P.selectedPlayer)!=null&&t.available)?N.push({name:e.media_type,params:{itemId:e.item_id,provider:e.provider}}):P.selectedPlayer&&R.playMedia(e)};L(()=>r.value,()=>{clearTimeout(C.value),C.value=setTimeout(()=>{j()},200)});const K=function(e){return e<500?2:e<=500?3:e<=700?4:e<=1e3?5:e<=1200?6:e<=1500?7:e<=1700?8:e>1700?9:0},j=async function(){w.value=!0,localStorage.setItem("globalsearch",r.value),r.value?l.value=await R.search(r.value):l.value=void 0,w.value=!1},o=k(()=>M[y.value]),f=k(()=>{if(!l.value)return[];if(o.value=="artists")return l.value.artists;if(o.value=="albums")return l.value.albums;if(o.value=="tracks")return l.value.tracks;if(o.value=="playlists")return l.value.playlists;if(o.value=="radios")return l.value.radio;if(o.value=="topresult"){const e=[];for(const t of[l.value.tracks,l.value.artists,l.value.albums,l.value.playlists,l.value.radio]){const a=[];for(const h of t)a.includes(h.provider)||(e.push(h),a.push(h.provider))}return e}return[]});L(()=>o.value,e=>{if(e){const t=localStorage.getItem(`viewMode.search.${o.value}`);t?s.value=t:o.value=="artists"||o.value=="albums"?s.value="panel":s.value="list"}},{immediate:!0}),O(()=>{if(x.initSearch)r.value=x.initSearch;else{const e=localStorage.getItem("globalsearch");e&&e!=="null"&&(r.value=e)}});const I=function(e){d.value||(e.key==="a"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),c.value=f.value):!p.value&&e.key=="Backspace"?r.value=r.value.slice(0,-1):!p.value&&e.key.length==1&&(r.value+=e.key))};return document.addEventListener("keydown",I),Q(()=>{document.removeEventListener("keydown",I)}),(e,t)=>(v(),g("div",null,[i(ae,{id:"searchInput",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:e.$t("type_to_search"),"hide-details":"",variant:"filled",onFocus:t[1]||(t[1]=a=>p.value=!0),onBlur:t[2]||(t[2]=a=>p.value=!1)},null,8,["modelValue","label"]),V("div",null,[i(le,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),column:"",style:{"margin-top":"15px","margin-left":"10px"}},{default:n(()=>[(v(),g(S,null,T(M,a=>i(se,{key:a,filter:"",outlined:""},{default:n(()=>[X($(e.$t(a)),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),i(z,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=a=>d.value=a),items:c.value,onClear:t[5]||(t[5]=()=>{c.value=[]})},null,8,["modelValue","items"]),V("div",me,[w.value?(v(),b(ne,{key:0,indeterminate:""})):_("",!0),s.value=="panel"?(v(),b(re,{key:1},{default:n(()=>[(v(!0),g(S,null,T(m(f),a=>(v(),b(oe,{key:a.uri,class:Y(`col-${K(e.$vuetify.display.width)}`)},{default:n(()=>[i(te,{item:a,size:m(E),"is-selected":!1,"show-checkboxes":!1,onMenu:B,onClick:F},null,8,["item","size"])]),_:2},1032,["class"]))),128))]),_:1})):_("",!0),s.value=="list"?(v(),g("div",pe,[i(m(q),{items:m(f),"item-size":60,"key-field":"item_id","page-mode":""},{default:n(({item:a})=>[i(Z,{item:a,"show-track-number":!1,"show-duration":!0,"show-library":!1,"show-menu":!0,"show-providers":!0,"show-checkboxes":!1,"is-selected":!1,"show-details":!0,onMenu:B,onClick:F},null,8,["item"])]),_:1},8,["items"])])):_("",!0)]),i(ve,{density:"compact",variant:"flat",color:"transparent",height:"45"},{default:n(()=>[V("span",de,$(e.$t("items_total",[m(f).length])),1),i(ee),i(ie,{location:"bottom"},{activator:n(({props:a})=>[i(ue,W(a,{icon:s.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:t[6]||(t[6]=h=>G())}),null,16,["icon"])]),default:n(()=>[V("span",null,$(e.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1})])]))}});export{Ue as default};
