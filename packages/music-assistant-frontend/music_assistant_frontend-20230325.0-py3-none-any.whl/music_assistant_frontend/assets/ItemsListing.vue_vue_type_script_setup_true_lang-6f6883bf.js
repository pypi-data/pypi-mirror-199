import{g as ne,a4 as Se,B as se,t as Z,a5 as $e,a6 as Ae,a7 as Le,b as s,a8 as Ee,a9 as Te,m as A,aa as Be,u as De,E as Me,r as y,z as O,o as K,ab as Pe,ac as xe,h as f,q as $,ad as G,p as V,l as L,v as h,H as ie,ae as Oe,af as Ne,d as Fe,n as X,e as Re,V as R,A as z,w as u,i as E,k as ee,s as q,F as te,x as ae,j as U,U as qe}from"./index-6b8e9665.js";import{s as Ue}from"./vue-virtual-scroller.esm-1d586c71.js";/* empty css                             */import{L as Ke}from"./ListviewItem-d7abb943.js";import{_ as He,V as je,i as Ge,a as Xe}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-59990fbf.js";import{V as Ye}from"./VToolbar-acf511e0.js";import{V as We}from"./VSelect-2ae84853.js";import{V as Je,a as Qe}from"./VRow-ea08c5c4.js";import{V as le}from"./VAlert-ab5bd938.js";import{n as re,d as ue,e as Ze,g as ze,i as ce,o as et,p as de,u as me,V as x,q as tt,r as at,s as lt,v as ot,w as nt,x as st,a as D,l as it}from"./VBtn-78ffa2a3.js";import{m as rt,u as ut,f as ct,b as dt,a as mt,V as vt}from"./forwardRefs-5242d0a6.js";import{V as P}from"./VTooltip-f86f9b47.js";import{m as ft,M as pt,V as gt,d as bt}from"./VCardText-3c6786ab.js";import{a as yt}from"./VCard-a22457ec.js";import{V as ht}from"./VMenu-c38191cf.js";import{V as kt}from"./VDivider-eaeef5d4.js";const wt=ne()({name:"VBadge",inheritAttrs:!1,props:{bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:Se,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...re({location:"top end"}),...ue(),...Ze(),...se(),...ft({transition:"scale-rotate-transition"})},setup(e,m){const{backgroundColorClasses:o,backgroundColorStyles:r}=ze(Z(e,"color")),{roundedClasses:C}=ce(e),{t:p}=$e(),{textColorClasses:i,textColorStyles:I}=et(Z(e,"textColor")),{themeClasses:T}=Ae(),{locationStyles:_}=de(e,!0,g=>(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(g)?+(e.offsetY??0):["left","right"].includes(g)?+(e.offsetX??0):0));return me(()=>{const g=Number(e.content),n=!e.max||isNaN(g)?e.content:g<=e.max?g:`${e.max}+`,[a,k]=Le(m.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return s(e.tag,A({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline}]},k),{default:()=>{var v,b;return[s("div",{class:"v-badge__wrapper"},[(b=(v=m.slots).default)==null?void 0:b.call(v),s(pt,{transition:e.transition},{default:()=>{var d,S;return[Ee(s("span",A({class:["v-badge__badge",T.value,o.value,C.value,i.value],style:[r.value,I.value,e.inline?{}:_.value],"aria-atomic":"true","aria-label":p(e.label,g),"aria-live":"polite",role:"status"},a),[e.dot?void 0:m.slots.badge?(S=(d=m.slots).badge)==null?void 0:S.call(d):e.icon?s(x,{icon:e.icon},null):n]),[[Te,e.modelValue]])]}})])]}})}),{}}});const Vt=ne()({name:"VSnackbar",props:{multiLine:Boolean,timeout:{type:[Number,String],default:5e3},vertical:Boolean,...re({location:"bottom"}),...tt(),...ue(),...at(),...se(),...Be(rt({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},emits:{"update:modelValue":e=>!0},setup(e,m){let{slots:o}=m;const r=De(e,"modelValue"),{locationStyles:C}=de(e),{positionClasses:p}=lt(e),{scopeId:i}=ut(),{themeClasses:I}=Me(e),{colorClasses:T,colorStyles:_,variantClasses:g}=ot(e),{roundedClasses:n}=ce(e),a=y();O(r,v),O(()=>e.timeout,v),K(()=>{r.value&&v()});let k=-1;function v(){window.clearTimeout(k);const d=Number(e.timeout);!r.value||d===-1||(k=window.setTimeout(()=>{r.value=!1},d))}function b(){window.clearTimeout(k)}return me(()=>{const[d]=dt(e);return s(mt,A({ref:a,class:["v-snackbar",{"v-snackbar--active":r.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--vertical":e.vertical},p.value]},d,{modelValue:r.value,"onUpdate:modelValue":S=>r.value=S,contentProps:A({class:["v-snackbar__wrapper",I.value,T.value,n.value,g.value],style:[C.value,_.value],onPointerenter:b,onPointerleave:v},d.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0},i),{default:()=>[nt(!1,"v-snackbar"),o.default&&s("div",{class:"v-snackbar__content",role:"status","aria-live":"polite"},[o.default()]),o.actions&&s(st,{defaults:{VBtn:{variant:"text",ripple:!1}}},{default:()=>[s("div",{class:"v-snackbar__actions"},[o.actions()])]})],activator:o.activator})}),ct({},a)}}),ve=(e,m)=>{const o=e.__vccOpts||e;for(const[r,C]of m)o[r]=C;return o},Ct={},_t=e=>(Oe("data-v-259be2b2"),e=e(),Ne(),e),It={class:"container"},St=_t(()=>L("div",{class:"spinner"},null,-1)),$t=[St];function At(e,m){return f(),$("div",It,$t)}const Lt=ve(Ct,[["render",At],["__scopeId","data-v-259be2b2"],["__file","/home/oumoussa/side-projects/infinite/src/components/Spinner.vue"]]),Et=e=>({loading(){e.value="loading"},loaded(){e.value="loaded"},complete(){e.value="complete"},error(){e.value="error"}}),Tt=(e,m,o)=>()=>{const r=o.parentEl||document.documentElement;o.prevHeight=r.scrollHeight,m.loading(),e("infinite",m)},Bt=(e,m)=>{const o=e.getBoundingClientRect();if(!m)return o.top>=0&&o.bottom<=window.innerHeight;const r=m.getBoundingClientRect();return o.top>=r.top&&o.bottom<=r.bottom},oe=e=>{e.parentEl=document.querySelector(e.target)||null;let m=`0px 0px ${e.distance}px 0px`;e.top&&(m=`${e.distance}px 0px 0px 0px`);const o=new IntersectionObserver(r=>{r[0].isIntersecting&&(e.firstload&&e.emit(),e.firstload=!0)},{root:e.parentEl,rootMargin:m});return o.observe(e.infiniteLoading.value),o},Dt={class:"state-error"},Mt={__name:"InfiniteLoading",props:{top:{type:Boolean,required:!1},target:{type:[String,Boolean],required:!1},distance:{type:Number,required:!1,default:0},identifier:{required:!1},firstload:{type:Boolean,required:!1,default:!0},slots:{type:Object,required:!1}},emits:["infinite"],setup(e,{emit:m}){const o=e;let r=null;const C=y(null),p=y("ready"),{top:i,firstload:I,target:T,distance:_}=o,{identifier:g}=Pe(o),n={infiniteLoading:C,target:T,top:i,firstload:I,distance:_,prevHeight:0,parentEl:null};n.emit=Tt(m,Et(p),n);const a=()=>O(p,async v=>{const b=n.parentEl||document.documentElement;await ie(),v=="loaded"&&i&&(b.scrollTop=b.scrollHeight-n.prevHeight),v=="loaded"&&Bt(C.value,n.parentEl)&&n.emit(),v=="complete"&&r.disconnect()}),k=()=>O(g,()=>{p.value="ready",r.disconnect(),r=oe(n)});return K(()=>{r=oe(n),a(),g&&k()}),xe(()=>{r.disconnect()}),(v,b)=>(f(),$("div",{ref_key:"infiniteLoading",ref:C},[p.value=="loading"?G(v.$slots,"spinner",{key:0},()=>[s(Lt)],!0):V("v-if",!0),p.value=="complete"?G(v.$slots,"complete",{key:1},()=>{var d;return[L("span",null,h(((d=e.slots)==null?void 0:d.complete)||"No more results!"),1)]},!0):V("v-if",!0),p.value=="error"?G(v.$slots,"error",{key:2,retry:n.emit},()=>{var d;return[L("span",Dt,[L("span",null,h(((d=e.slots)==null?void 0:d.error)||"Oops something went wrong!"),1),L("button",{class:"retry",onClick:b[0]||(b[0]=(...S)=>n.emit&&n.emit(...S))}," retry ")])]},!0):V("v-if",!0)],512))}},Pt=ve(Mt,[["__scopeId","data-v-9d82030b"],["__file","/home/oumoussa/side-projects/infinite/src/components/InfiniteLoading.vue"]]);const xt={key:0},Ot={key:0},Nt={key:1},Ft={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},Rt={key:2},qt={key:3},oa=function(e,m,o,r,C,p=!0){var _,g;let i=[];if(C){const n=C.toLowerCase();for(const a of e)(a.name.toLowerCase().includes(n)||"artist"in a&&((_=a.artist)!=null&&_.name.toLowerCase().includes(n))||"album"in a&&((g=a.album)!=null&&g.name.toLowerCase().includes(n))||"artists"in a&&a.artists&&a.artists[0].name.toLowerCase().includes(n))&&i.push(a)}else i=e;r=="sort_name"&&i.sort((n,a)=>(n.sort_name||n.name).localeCompare(a.sort_name||a.name)),r=="sort_album"&&i.sort((n,a)=>{var k,v;return(v=n.album)==null?void 0:v.name.localeCompare((k=a.album)==null?void 0:k.name)}),r=="sort_artist"&&i.sort((n,a)=>n.artists[0].name.localeCompare(a.artists[0].name)),r=="track_number"&&(i.sort((n,a)=>(n.track_number||0)-(a.track_number||0)),i.sort((n,a)=>(n.disc_number||0)-(a.disc_number||0))),r=="position"&&i.sort((n,a)=>(n.position||0)-(a.position||0)),r=="year"&&i.sort((n,a)=>(n.year||0)-(a.year||0)),r=="timestamp_added DESC"&&i.sort((n,a)=>(a.timestamp_added||0)-(n.timestamp_added||0)),r=="duration"&&i.sort((n,a)=>(n.duration||0)-(a.duration||0)),r=="provider"&&i.sort((n,a)=>n.provider.localeCompare(a.provider)),p&&(i=i.filter(n=>n.in_library));const I=i.length,T=i.slice(m,m+o);return{items:T,count:T.length,limit:o,offset:m,total:I}},na=Fe({__name:"ItemsListing",props:{itemtype:null,sortKeys:{default:()=>["sort_name","timestamp_added DESC"]},showTrackNumber:{type:Boolean,default:!0},showProviders:{type:Boolean,default:Object.keys(X.providers).length>1},showMenu:{type:Boolean,default:!0},showLibrary:{type:Boolean,default:!0},showDuration:{type:Boolean,default:!0},parentItem:{default:void 0},showAlbumArtistsOnlyFilter:{type:Boolean},updateAvailable:{type:Boolean},loadData:null},emits:["toggleAlbumArtistsOnly","refreshClicked"],setup(e,{emit:m}){const o=e,r=100,C=Re(),p=y("list"),i=y(""),I=y("sort_name"),T=y(!1),_=y(!1),g=y(!1),n=y(0),a=y([]),k=y(),v=y(!1),b=y(!1),d=y([]),S=y(!1),fe=y(!1),N=y(!1),M=y(!1),pe=function(){_.value?_.value=!1:(_.value=!0,ie(()=>{var t;(t=document.getElementById("searchInput"))==null||t.focus()}))},ge=function(t){return t<500?2:t<=500?3:t<=700?4:t<=1e3?5:t<=1200?6:t<=1500?7:t<=1700?8:t>1700?9:8},be=function(){p.value==="panel"?p.value="list":p.value="panel",localStorage.setItem(`viewMode.${o.itemtype}`,p.value)},ye=function(){b.value=!b.value;const t=b.value?"true":"false";localStorage.setItem(`libraryFilter.${o.itemtype}`,t),B(!0)},he=function(){M.value=!M.value;const t=M.value?"true":"false";localStorage.setItem(`albumArtistsFilter.${o.itemtype}`,t),m("toggleAlbumArtistsOnly",M.value),B(!0)},Y=function(t){return d.value.includes(t)},W=function(t,c){if(c)d.value.includes(t)||d.value.push(t);else for(let l=0;l<d.value.length;l++)d.value[l]===t&&d.value.splice(l,1);q.blockGlobalPlayMenu=d.value.length>0},ke=function(){d.value=[],N.value=!1,q.blockGlobalPlayMenu=!1},H=function(){d.value.length>0?S.value=!0:N.value=!N.value},we=function(t){B(!0)},j=function(t){d.value=[t],S.value=!0},Ve=function(){B(!0),m("refreshClicked")},J=function(t){var l;if(!Ge(t)){j(t);return}const c=o.itemtype.includes("versions").toString();["artist","album","playlist"].includes(t.media_type)||c=="true"||!((l=q.selectedPlayer)!=null&&l.available)?C.push({name:t.media_type,params:{itemId:t.item_id,provider:t.provider,forceProviderVersion:c}}):q.selectedPlayer&&X.playMedia(t)},Ce=function(t,c){t!==void 0&&(I.value=t),localStorage.setItem(`sortBy.${o.itemtype}`,I.value),B(!0)},_e=function(t){if(a.value.length==0){t.loaded();return}if(k.value!==void 0&&n.value>=k.value){t.loaded();return}n.value+=r,B().then(()=>{t.loaded()})},Ie=function(){localStorage.setItem("globalsearch",i.value),C.push({name:"search",params:{initSearch:i.value}})};O(()=>i.value,t=>{t&&(_.value=!0),B(!0)}),O(()=>o.updateAvailable,t=>{t&&a.value.length==0&&B(!0)});const B=async function(t=!1,c=r){t&&(n.value=0,fe.value=!1),v.value=!0;const l=await o.loadData(n.value,c,I.value,i.value||"",b.value);n.value?a.value.push(...l.items):a.value=l.items,k.value=l.total,v.value=!1;let w=`search.${o.itemtype}`;o.parentItem&&(w+=o.parentItem.item_id),localStorage.setItem(w,i.value)};K(()=>{const t=localStorage.getItem(`viewMode.${o.itemtype}`);t&&t!=="null"?p.value=t:o.itemtype=="artists"||o.itemtype=="albums"?p.value="panel":p.value="list";const c=localStorage.getItem(`sortBy.${o.itemtype}`);if(c&&c!=="null"?I.value=c:I.value=o.sortKeys[0],o.showLibrary!==!1){const F=localStorage.getItem(`libraryFilter.${o.itemtype}`);F&&F=="true"&&(b.value=!0)}if(o.showAlbumArtistsOnlyFilter!==!1){const F=localStorage.getItem(`albumArtistsFilter.${o.itemtype}`);F&&F=="true"&&(M.value=!0,m("toggleAlbumArtistsOnly",M.value))}let l=`search.${o.itemtype}`;o.parentItem&&(l+=o.parentItem.item_id);const w=localStorage.getItem(l);w&&w!=="null"&&(console.log("savedSearch",w),i.value=w),B(!0)}),K(()=>{const t=X.subscribe_multi([R.MEDIA_ITEM_ADDED,R.MEDIA_ITEM_UPDATED,R.MEDIA_ITEM_DELETED],c=>{if(c.event==R.MEDIA_ITEM_DELETED)a.value=a.value.filter(l=>l.uri!=c.object_id);else if(c.event==R.MEDIA_ITEM_UPDATED){const l=c.data;a.value=a.value.map(w=>w.uri==l.uri?l:w)}});z(t)});const Q=function(t){S.value||(t.key==="a"&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),d.value=a.value):!g.value&&t.key=="Backspace"?i.value=i.value.slice(0,-1):!g.value&&t.key.length==1&&(i.value+=t.key,_.value=!0))};return document.addEventListener("keydown",Q),z(()=>{document.removeEventListener("keydown",Q)}),(t,c)=>(f(),$("section",null,[s(Ye,{density:"compact",variant:"flat",color:"transparent"},{default:u(()=>[s(P,{location:"bottom"},{activator:u(({props:l})=>[s(D,A(l,{icon:d.value.length>0?"mdi-checkbox-multiple-outline":"mdi-checkbox-multiple-blank-outline",variant:"plain",onClick:H}),null,16,["icon"]),t.$vuetify.display.mobile?V("",!0):(f(),$("span",xt,[!d.value.length&&k.value?(f(),$("span",{key:0,style:{cursor:"pointer"},onClick:H},h(t.$t("items_total",[k.value])),1)):d.value.length?(f(),$("span",{key:1,style:{cursor:"pointer"},onClick:H},h(t.$t("items_selected",[d.value.length])),1)):V("",!0)]))]),default:u(()=>[L("span",null,h(t.$t("tooltip.select_items")),1)]),_:1}),s(je),s(P,{location:"bottom","close-on-content-click":""},{activator:u(({props:l})=>[e.showLibrary!==!1?(f(),E(D,A({key:0},l,{icon:"",variant:"plain",onClick:ye}),{default:u(()=>[s(x,{icon:b.value?"mdi-heart":"mdi-heart-outline"},null,8,["icon"])]),_:2},1040)):V("",!0)]),default:u(()=>[L("span",null,h(t.$t("tooltip.filter_library")),1)]),_:1}),e.showAlbumArtistsOnlyFilter?(f(),E(P,{key:0,location:"bottom"},{activator:u(({props:l})=>[s(D,A(l,{icon:"",variant:"plain",onClick:he}),{default:u(()=>[s(x,{icon:M.value?"mdi-account-music":"mdi-account-music-outline"},null,8,["icon"])]),_:2},1040)]),default:u(()=>[L("span",null,h(t.$t("tooltip.album_artist_filter")),1)]),_:1})):V("",!0),s(P,{location:"bottom"},{activator:u(({props:l})=>[s(D,A(l,{icon:"",variant:"plain",onClick:c[0]||(c[0]=w=>Ve())}),{default:u(()=>[s(wt,{"model-value":e.updateAvailable,color:"error",dot:""},{default:u(()=>[s(x,{icon:"mdi-refresh"})]),_:1},8,["model-value"])]),_:2},1040)]),default:u(()=>[e.updateAvailable?(f(),$("span",Ot,h(t.$t("tooltip.refresh_new_content")),1)):(f(),$("span",Nt,h(t.$t("tooltip.refresh")),1))]),_:1}),e.sortKeys.length>1?(f(),E(ht,{key:1,modelValue:T.value,"onUpdate:modelValue":c[1]||(c[1]=l=>T.value=l),location:"bottom end","close-on-content-click":!0},{activator:u(({props:l})=>[s(P,{location:"bottom"},{activator:u(({props:w})=>[s(D,A({icon:""},o,{variant:"plain"}),{default:u(()=>[s(x,A(A(l,w),{icon:"mdi-sort"}),null,16)]),_:2},1040)]),default:u(()=>[L("span",null,h(t.$t("tooltip.sort_options")),1)]),_:2},1024)]),default:u(()=>[s(yt,null,{default:u(()=>[s(vt,null,{default:u(()=>[(f(!0),$(te,null,ae(e.sortKeys,l=>(f(),$("div",{key:l},[s(gt,{onClick:w=>Ce(l)},{append:u(()=>[I.value==l?(f(),E(x,{key:0,icon:"mdi-check"})):V("",!0)]),default:u(()=>[s(bt,null,{default:u(()=>[U(h(t.$t("sort."+l)),1)]),_:2},1024)]),_:2},1032,["onClick"]),s(kt)]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])):V("",!0),s(P,{location:"bottom"},{activator:u(({props:l})=>[s(D,A(l,{icon:"",variant:"plain",onClick:c[2]||(c[2]=w=>pe())}),{default:u(()=>[s(x,{icon:"mdi-magnify"})]),_:2},1040)]),default:u(()=>[L("span",null,h(t.$t("tooltip.search")),1)]),_:1}),s(P,{location:"bottom"},{activator:u(({props:l})=>[s(D,A(l,{icon:p.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:c[3]||(c[3]=w=>be())}),null,16,["icon"])]),default:u(()=>[L("span",null,h(t.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1}),s(He,{modelValue:S.value,"onUpdate:modelValue":c[4]||(c[4]=l=>S.value=l),items:d.value,"parent-item":e.parentItem,onClear:ke,onDelete:we},null,8,["modelValue","items","parent-item"]),_.value?(f(),E(We,{key:0,id:"searchInput",modelValue:i.value,"onUpdate:modelValue":c[5]||(c[5]=l=>i.value=l),clearable:"","prepend-inner-icon":"mdi-magnify",label:t.$t("search"),"hide-details":"",variant:"filled",style:{width:"auto","margin-left":"15px","margin-right":"15px","margin-top":"10px"},onFocus:c[6]||(c[6]=l=>g.value=!0),onBlur:c[7]||(c[7]=l=>g.value=!1)},null,8,["modelValue","label"])):V("",!0),L("div",Ft,[v.value?(f(),E(it,{key:0,indeterminate:""})):V("",!0),p.value=="panel"?(f(),E(Je,{key:1},{default:u(()=>[(f(!0),$(te,null,ae(a.value,l=>(f(),E(Qe,{key:l.uri,class:qe(`col-${ge(t.$vuetify.display.width)}`)},{default:u(()=>[s(Xe,{item:l,"is-selected":Y(l),"show-checkboxes":N.value,onSelect:W,onMenu:j,onClick:J},null,8,["item","is-selected","show-checkboxes"])]),_:2},1032,["class"]))),128))]),_:1})):V("",!0),p.value=="list"?(f(),$("div",Rt,[s(ee(Ue),{items:a.value,"item-size":60,"key-field":"uri","page-mode":""},{default:u(({item:l})=>[(f(),E(Ke,{key:l.uri,item:l,"show-track-number":e.showTrackNumber,"show-duration":e.showDuration,"show-library":e.showLibrary!==!1&&!b.value,"show-menu":e.showMenu,"show-providers":e.showProviders,"show-checkboxes":N.value,"is-selected":Y(l),"show-details":e.itemtype.includes("versions"),"parent-item":e.parentItem,onSelect:W,onMenu:j,onClick:J},null,8,["item","show-track-number","show-duration","show-library","show-menu","show-providers","show-checkboxes","is-selected","show-details","parent-item"]))]),_:1},8,["items"])])):V("",!0),s(ee(Pt),{onInfinite:_e}),!v.value&&a.value.length==0?(f(),$("div",qt,[!v.value&&a.value.length==0&&(i.value||b.value)?(f(),E(le,{key:0,density:"compact",variant:"outlined",title:t.$t("no_content_filter")},{default:u(()=>[i.value?(f(),E(D,{key:0,style:{"margin-top":"15px"},onClick:Ie},{default:u(()=>[U(h(t.$t("try_global_search")),1)]),_:1})):V("",!0)]),_:1},8,["title"])):!v.value&&a.value.length==0?(f(),E(le,{key:1,density:"compact",variant:"outlined"},{default:u(()=>[U(h(t.$t("no_content")),1)]),_:1})):V("",!0)])):V("",!0),s(Vt,{"model-value":d.value.length>1,timeout:-1,style:{"margin-bottom":"120px"}},{actions:u(()=>[s(D,{color:"primary",variant:"text",onClick:c[8]||(c[8]=l=>S.value=!0)},{default:u(()=>[U(h(t.$t("actions")),1)]),_:1})]),default:u(()=>[L("span",null,h(t.$t("items_selected",[d.value.length])),1)]),_:1},8,["model-value"])])]))}});export{na as _,oa as f};
